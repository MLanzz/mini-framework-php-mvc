document.addEventListener("DOMContentLoaded",()=>{initServices()});const initServices=()=>{initModal(),initDeleteService()},initModal=()=>{document.querySelector("#createService").addEventListener("click",()=>{openModal()});document.querySelectorAll("[name='serviceUpdate']").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.dataset.id,i=e.target.dataset.servicename,r=e.target.dataset.serviceprice;openModal(t,i,r)})});const e=document.querySelector("dialog");document.querySelector("#cancel-modal").addEventListener("click",()=>{e.close()}),e.addEventListener("click",t=>{const i=e.getBoundingClientRect();(t.clientX<i.left||t.clientX>i.right||t.clientY<i.top||t.clientY>i.bottom)&&e.close()}),submitBtn=document.querySelector("#submit-modal"),submitBtn.addEventListener("click",()=>{const e=document.querySelector("#dialogServiceId").value,t=document.querySelector("#dialogServiceName").value,i=document.querySelector("#dialogServicePrice").value;saveService(e,t,i)})},openModal=(e=0,t="",i="")=>{const r=document.querySelector("#dialogServiceId"),c=document.querySelector("#dialogServiceName"),n=document.querySelector("#dialogServicePrice");r.value=e,c.value=t,n.value=i,document.querySelector("dialog").showModal()},saveService=async(e,t,i)=>{const r=new FormData;r.append("id",e),r.append("serviceName",t),r.append("price",i);try{const t=await fetch("/api/saveService",{method:"POST",body:r}),i=await t.json();let c,n;if("0"!==e?(c=i.result,n="actualizado"):(c=i.result.resultado,n="creado"),document.querySelector("dialog").close(),c)Swal.fire({icon:"success",title:"Servicio "+n,text:`Servicio ${n} correctamente!`,heightAuto:!1}).then(()=>{console.log("llego"),renderService(i.service)});else{let e="";i.errors.forEach(t=>{e+=`<li>${t}</li>`}),console.log(e),Swal.fire({icon:"warning",html:`\n                    <b>Ocurrieron los siguientes errores:</b>\n                    <ul><b>${e}</b></ul>\n                `,heightAuto:!1})}}catch(e){Swal.fire({icon:"error",title:"Error",text:"Ocurrió un error guardando el servicio - "+e,heightAuto:!1})}},renderService=e=>{const{id:t,serviceName:i,price:r}=e;let c=Array.from(document.querySelectorAll("ul[id='service-list'] li")).find(e=>e.dataset.serviceId===t);if(c)c.innerHTML=`\n            <p><span>Nombre:</span> <span class="service-desc">${i}</span></p>\n            <p><span>Precio:</span> $ <span class="service-desc">${r}</span></p>\n            <div class="buttons-container">\n                <input type="button" class="button" value="Actualizar servicio" name="serviceUpdate" data-id="${t}" data-serviceName="${i}" data-servicePrice="${r}">\n                \n                <input type="button" class="button-delete" value="Eliminar servicio" name="serviceDelete" data-id="${t}">\n            </div>\n        `;else{const e=`\n            <li data-service-id="${t}">\n                <p><span>Nombre:</span> <span class="service-desc">${i}</span></p>\n                <p><span>Precio:</span> $ <span class="service-desc">${r}</span></p>\n                <div class="buttons-container">\n                    <input type="button" class="button" value="Actualizar servicio" name="serviceUpdate" data-id="${t}" data-serviceName="${i}" data-servicePrice="${r}">\n                    \n                    <input type="button" class="button-delete" value="Eliminar servicio" name="serviceDelete" data-id="${t}">\n                </div>\n            </li>\n            <hr>\n        `;document.querySelector("#service-list").insertAdjacentHTML("beforeend",e)}},initDeleteService=()=>{document.querySelectorAll("[name='serviceDelete']").forEach(e=>{e.addEventListener("click",e=>{Swal.fire({title:"¿Estas seguro que desea eliminar el servicio?",icon:"warning",showCancelButton:!0,confirmButtonText:"Cancelar",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Eliminar",heightAuto:!1}).then(t=>{if(t.isConfirmed){const t=e.target.dataset.id;deleteService(t)}})})})},deleteService=async e=>{const t=new FormData;t.append("id",e);try{const i=await fetch("/api/deleteService",{method:"POST",body:t}),{result:r}=await i.json();r?(Swal.fire({title:"Servicio Eliminado",text:"Servicio eliminado correctamente",icon:"success",heightAuto:!1}),removeService(e)):Swal.fire({title:"Error Eliminado",text:"Ocurrió un error eliminando el servicio",icon:"error",heightAuto:!1})}catch(e){Swal.fire({icon:"error",title:"Error",text:"Ocurrió un error eliminando el servicio - "+e,heightAuto:!1})}},removeService=e=>{const t=document.querySelector(`ul li[data-service-id="${e}"]`);t.nextElementSibling.remove(),t.remove()};